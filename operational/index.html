<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="description" content="IBM WebSphere Liberty for Amazon EKS Operational Guide on AWS">
<meta name="keywords" content="Partner Solution, AWS, IBM WebSphere Liberty for Amazon EKS">
<title>IBM WebSphere Liberty for Amazon EKS on AWSâ€”Operational Guide</title>
<style>
/* Import the main IA stylesheet */
@import url("../docs/boilerplate/.css/ia-css.css");

/* Modify the image location for an additional level */
#toc.toc2 #toctitle {
  background-image: url("../docs/boilerplate/.images/AWS-Logo.svg");
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_connect_to_the_eks_cluster">Connect to the EKS cluster</a>
<ul class="sectlevel2">
<li><a href="#_connect_with_the_boot_node">Connect with the boot node</a></li>
<li><a href="#_connect_without_the_boot_node">Connect without the boot node</a></li>
</ul>
</li>
<li><a href="#_find_your_deployment_logs">Find your deployment logs</a>
<ul class="sectlevel2">
<li><a href="#_cloudwatch_log_streams">CloudWatch log streams</a></li>
<li><a href="#_lambda_function_logs">Lambda function logs</a></li>
<li><a href="#_ssm_logs">SSM logs</a></li>
</ul>
</li>
<li><a href="#_get_information_about_your_deployments">Get information about your deployments</a></li>
<li><a href="#_recover_from_a_failed_stack">Recover from a failed stack</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
<li><a href="#_resources">Resources</a></li>
<li><a href="#_feedback">Feedback</a></li>
<li><a href="#_notices">Notices</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h2 id="_ibm_websphere_liberty_for_amazon_eks_on_aws" class="discrete text-center">IBM WebSphere Liberty for Amazon EKS on AWS</h2>
<h2 id="_partner_solution_operational_guide" class="discrete text-left text-center">Partner Solution Operational Guide</h2>
<div class="imageblock text-center">
<div class="content">
<img src="https://aws-quickstart.s3.amazonaws.com/docs/operational-guide/aws-quickstart-operational-graphic.png" alt="QS" width="80" height="80">
</div>
</div>
<div class="paragraph text-center">
<p><strong>December 2022</strong><br>
<em>Ranjan Kumar, Venu Beyagudem, Paul Baity, Jarek Gawor, Barbara Jones, and Pam Helyar, IBM</em><br>
<em>Senthil Nagaraj, AWS IBM Alliance team</em><br>
<em>Troy Lindsay and Vinod Shukla, AWS Integration &amp; Automation team</em><br></p>
</div>
<div class="imageblock text-left image-container">
<div class="content">
<img src="https://aws-quickstart.s3.amazonaws.com/quickstart-ibm-liberty-eks/docs/boilerplate/.images/aws-quickstart-operational-graphic.png" alt="">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Visit our <a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks" target="_blank" rel="noopener">GitHub repository</a> to view source files, report bugs, submit feature ideas, and post feedback about this Partner Solution. To comment on the documentation, refer to <a href="#_feedback">Feedback</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph text-left">
<p>This Partner Solution was created by IBM in collaboration with Amazon Web Services (AWS). <a href="https://aws.amazon.com/solutions/partners/" target="_blank" rel="noopener">Partner Solutions</a> are automated reference deployments that help people deploy popular technologies on AWS according to AWS best practices. If you&#8217;re unfamiliar with AWS Partner Solutions, refer to the <a href="https://fwd.aws/rA69w?" target="_blank" rel="noopener">AWS Partner Solution General Information Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide covers information you need to use your IBM WebSphere Liberty for Amazon EKS Partner Solution.</p>
</div>
<div class="paragraph">
<p>For deployment instructions, refer to the <a href="https://fwd.aws/pGdpv?" target="_blank" rel="noopener">IBM WebSphere Liberty for Amazon EKS Partner Solution Deployment Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_to_the_eks_cluster">Connect to the EKS cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The steps you follow to connect to the EKS cluster depend on whether you use the boot node. After you connect, you can use <code>kubectl</code> commands to manage your cluster.</p>
</div>
<div class="sect2">
<h3 id="_connect_with_the_boot_node">Connect with the boot node</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the AWS CloudFormation console, go to the boot node. Look under the <strong>Resources</strong> tab of the boot-node stack. The node ID is listed in <strong>Outputs</strong> of the main stack.</p>
</li>
<li>
<p>Start the boot node.</p>
</li>
<li>
<p>Enable SSH (Secure Shell) to the boot node. Add a rule to the virtual private cloud (VPC) security group that permits inbound traffic on port 22.</p>
</li>
<li>
<p>Connect to the boot node by using SSH or <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html" target="_blank" rel="noopener">EC2 Instance Connect</a> in your browser.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_connect_without_the_boot_node">Connect without the boot node</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you haven&#8217;t done so already, check your Amazon Resource Name (ARN) configuration. For details, refer to the <a href="https://aws-quickstart.github.io/quickstart-ibm-liberty-eks/index.html#_predeployment_steps" target="_blank" rel="noopener">predeployment steps</a> in the <a href="https://fwd.aws/pGdpv?" target="_blank" rel="noopener">deployment guide</a>.</p>
</li>
<li>
<p>Use the Kubernetes command line interface to access the EKS cluster.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run the following command, replacing the information in brackets:</p>
<div class="listingblock">
<div class="content">
<pre>aws eks update-kubeconfig --name &lt;cluster_name&gt; --region &lt;cluster_region&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This command updates your <code>kubeconfig</code> file so that you can use <code>kubectl</code> commands to work with your cluster.</p>
</div>
</li>
<li>
<p>Run any <code>kubectl</code> command, such as this one:</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get pods</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the output messages show a connection to the cluster.</p>
<div class="paragraph">
<p>An <code>Unauthorized</code> error means that your IAM user or role was not granted access to the cluster. To gain access to the cluster, provide your IAM user ARN in the <code>AdditionalEKSAdminArns</code> parameter of the stack.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If needed, ask the creator of the EKS cluster to grant access by adding your IAM user or role to the <code>aws-auth</code> Kubernetes ConfigMap in the <code>kube-system</code> namespace. This ConfigMap maps IAM entities in AWS to user accounts in the Kubernetes cluster. The following steps use <a href="https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html" target="_blank" rel="noopener">eksctl</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the ARN of the IAM entity to which you want to grant cluster access.</p>
<div class="ulist">
<ul>
<li>
<p>Example user ARN: <code>arn:aws:iam::123456789012:user/user@example.com</code></p>
</li>
<li>
<p>Example role ARN: <code>arn:aws:iam::123456789012:role/some-role</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the <code>eksctl</code> command to create a mapping for that IAM entity in the <code>aws-auth</code> ConfigMap.</p>
<div class="listingblock">
<div class="content">
<pre>eksctl create iamidentitymapping --cluster "&lt;cluster_name&gt;" --region "&lt;cluster_region&gt;" --arn "&lt;arn&gt;"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_find_your_deployment_logs">Find your deployment logs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cloudwatch_log_streams">CloudWatch log streams</h3>
<div class="paragraph">
<p>You can find Amazon CloudWatch log streams either from the Amazon CloudWatch console or from your AWS CloudFormation stack.</p>
</div>
<div class="sect4">
<h5 id="_from_the_cloudwatch_console">From the CloudWatch console</h5>
<div class="paragraph">
<p>During or after deployment, and even after a failed deployment, you can view log data in <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html" target="_blank" rel="noopener">CloudWatch log streams</a> as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://console.aws.amazon.com/cloudwatch/" target="_blank" rel="noopener">CloudWatch console</a>.</p>
</li>
<li>
<p>In the navigation pane, choose <strong>Logs</strong>, <strong>Log groups</strong>.</p>
</li>
<li>
<p>On the <strong>Log groups</strong> page, enter the stack name in the search bar.</p>
</li>
<li>
<p>From the <strong>Log streams</strong> tab of the log group details, select the log stream to view.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_from_your_cloudformation_stack">From your CloudFormation stack</h5>
<div class="paragraph">
<p>After deployment, you can also view log streams from the <strong>Outputs</strong> tab for your CloudFormation stack.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choose the <strong>Outputs</strong> tab for your main stack.</p>
</li>
<li>
<p>Choose the value of the <code>CloudWatchInstallLogs</code> key.</p>
</li>
<li>
<p>From the <strong>Log streams</strong> tab of the log group details, select the output logs.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lambda_function_logs">Lambda function logs</h3>
<div class="paragraph">
<p>Lambda function logs are at <code>/aws/lambda/</code> and have the file path <code>/aws/lambda/&lt;name_of_lambda_resource&gt;</code>.</p>
</div>
<div class="paragraph">
<p>You can view Lambda function logs in CloudWatch.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the stack <strong>Resources</strong> tab, select a Lambda function.</p>
</li>
<li>
<p>Choose the <strong>Monitor</strong> tab.</p>
</li>
<li>
<p>Choose <strong>View logs in CloudWatch</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nested stacks such as <code>IBMLibertyBootNodeStack</code>, <code>IBMLibertyEKSClusterStack</code>, and <code>IBMLibertyWorkloadStack</code> have a Lambda function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ssm_logs">SSM logs</h3>
<div class="paragraph">
<p>SSM logs are on the boot node at <code>/var/log/amazon/ssm/</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_information_about_your_deployments">Get information about your deployments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get information about your IBM WebSphere Liberty operator and any applications you&#8217;ve deployed, run this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get deployments</pre>
</div>
</div>
<div class="paragraph">
<p>For a list of namespaces, append <code>-A</code> (shorthand for <code>--all-namespaces</code>). The application name and its namespace depend on your input. If you did not deploy an application, then no application or <code>cert-manager</code> deployments are in your list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get deployments -A

NAMESPACE    NAME

default      websphereliberty-app-sample
kube-system  coredns
olm          catalog-operator
olm          olm-operator
olm          packageserver
operators    cert-manager
operators    cert-manager-cainjector
operators    cert-manager-webhook
operators    wlo-controller-manager</pre>
</div>
</div>
<div class="paragraph">
<p>For stack outputs, go to the <strong>Outputs</strong> tab for your CloudFormation stack, or go to the CloudWatch console.</p>
</div>
<div class="paragraph">
<p>The CloudWatch <code>deployment.properties</code> file lists the deployment properties.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recover_from_a_failed_stack">Recover from a failed stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your stack fails, delete it and retry the deployment. Stack deletion deletes all the artifacts that the stack created, including the EKS cluster and everything deployed in the cluster.</p>
</div>
<div class="paragraph">
<p>Stack deletion might fail due to timeouts or resource dependencies. If this happens, try to delete the failed stack again. If you installed any external components after the deployment, such as Ingress, those resources are not deleted and might prevent stack deletion. In this case, manually delete the resources that are preventing stack deletion.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For troubleshooting common Partner Solution issues, refer to the <a href="https://fwd.aws/rA69w?" target="_blank" rel="noopener">AWS Partner Solution General Information Guide</a> and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html" target="_blank" rel="noopener">Troubleshooting CloudFormation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ibm.com/docs/SSEQTP_liberty/opr/ae/cfg-t-viewstatus.html" target="_blank" rel="noopener">Viewing operator application status</a></p>
</li>
<li>
<p><a href="https://www.ibm.com/docs/SSEQTP_liberty/opr/ae/t-troubleshooting.html" target="_blank" rel="noopener">Troubleshooting WebSphere Liberty operators</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feedback">Feedback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To submit feature ideas and report bugs, use the <strong>Issues</strong> section of the <a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks" target="_blank" rel="noopener">GitHub repository</a> for this Partner Solution. To submit code, refer to the <a href="https://fwd.aws/NwqYA?" target="_blank" rel="noopener">Partner Solution Contributor&#8217;s Guide</a>. To submit feedback on this deployment guide, use the following GitHub links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks/issues/new?labels=documentation,grammar+or+spelling&amp;title=Deployment+guide+feedback&amp;body=Section+heading:%0ADocumentation+issue+description:%0A" target="_blank" rel="noopener">Grammar or spelling</a></p>
</li>
<li>
<p><a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks/issues/new?labels=documentation,broken+link&amp;title=Deployment+guide+feedback&amp;body=Section+heading:%0ADocumentation+issue+description:%0A" target="_blank" rel="noopener">Broken link</a></p>
</li>
<li>
<p><a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks/issues/new?labels=documentation,inaccurate+content&amp;title=Deployment+guide+feedback&amp;body=Section+heading:%0ADocumentation+issue+description:%0A" target="_blank" rel="noopener">Inaccurate content</a></p>
</li>
<li>
<p><a href="https://github.com/aws-quickstart/quickstart-ibm-liberty-eks/issues/new?labels=documentation,display+and+design&amp;title=Deployment+guide+feedback&amp;body=Section+heading:%0ADocumentation+issue+description:%0A" target="_blank" rel="noopener">Display or design</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notices">Notices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document is provided for informational purposes only. It represents current AWS product offerings and practices as of the date of issue of this document, which are subject to change without notice. Customers are responsible for making their own independent assessment of the information in this document and any use of AWS products or services, each of which is provided "as is" without warranty of any kind, whether expressed or implied. This document does not create any warranties, representations, contractual commitments, conditions, or assurances from AWS, its affiliates, suppliers, or licensors. The responsibilities and liabilities of AWS to its customers are controlled by AWS agreements, and this document is not part of, nor does it modify, any agreement between AWS and its customers.</p>
</div>
<div class="paragraph">
<p>The software included with this paper is licensed under the Apache License, version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at <a href="https://aws.amazon.com/apache2.0/" target="_blank" rel="noopener">https://aws.amazon.com/apache2.0/</a> or in the accompanying "license" file. This code is distributed on an "as is" basis, without warranties or conditions of any kind, either expressed or implied. Refer to the License for specific language governing permissions and limitations.</p>
</div>
</div>
</div>
</div>
<footer>
    <p class="footer-text">
        <!-- We can use document attributes: -->
        <!-- Generated with Asciidoctor v2.0.17. -->
        <a href="https://aws.amazon.com/privacy/">Privacy</a> | <a href="https://aws.amazon.com/terms/">Site terms</a> |
        &copy; 2022, Amazon Web Services, Inc. or its affiliates and IBM. All rights reserved.
    </p>
</footer>
</body>
</html>